<html xmlns:t="http://tapestry.apache.org/schema/tapestry_5_0_0.xsd">
<head>
    <title>Job Analytics - Ping Service</title>
    <link rel="stylesheet" type="text/css" href="/css/all.css" />
	<link rel="icon" type="image/png" href="/favicon.png" /> 
    <link rel="stylesheet" type="text/css" href="/assets/anjlab/cubics/css/cube.css" />
    <link rel="stylesheet" type="text/css" href="/css/analytics.css" />
    <script type="text/javascript" src="/assets/anjlab/cubics/js/jquery-1.3.2.js"></script>
    <script type="text/javascript" src="/assets/anjlab/cubics/js/cube.js"></script>
    <!--[if IE]><script language="javascript" type="text/javascript" src="excanvas.min.js"></script><![endif]--> 
    <script type="text/javascript" src="/js/jquery.flot.js"></script>
    <script type="text/javascript" src="/js/jquery.flot.pie.js"></script>
    <script type="text/javascript" src="/js/analytics.js"></script>
</head>
<body>
	<t:topbar/>
	
   	<h2>Analytics Workspace</h2>
   	
   	<p>for ${job.titleFriendly} (statistics based on data from ${dateFrom} to ${dateTo})</p>
   	
   	<font color="red"><p>${message}</p></font>

	<t:if test="admin">
		Admin tasks: 
			<t:actionlink t:id="runCountJobResultsTask">Count Job Results</t:actionlink>
			&#160;
			<t:actionlink t:id="runBackupAndDeleteOldJobResultsTask">Backup and Delete Old Job Results</t:actionlink>
	</t:if>

	<p>
	<t:form>
		View: <t:select t:id="view" model="viewModel" value="view"/>
		<t:submit value="Show" />
		&#160;
		<a href="javascript:collapseAll();">Collapse All</a>&#160;
		<a href="javascript:collapseOne();">&#xAB; Less</a>&#160;
		<a href="javascript:expandOne();">More &#xBB;</a>&#160;
		<a href="javascript:expandAll();">Expand All</a>
	</t:form>
	</p>
   	
   	<table>
	   	<tr valign="top">
		   	<td>
				<p>
					<a href="/feedback?subject=Request for custom View">Need more views? Send a request (it's free)</a>
				</p>
		   		<t:outputraw value="cubeHTML" />
				<p>   	
			 	    Download raw data in 
					<t:actionlink t:id="exportCSV">CSV</t:actionlink>
					for analysis.
				</p>
		   	</td>
		   	<td align="center" style="padding-left: 50px;">
		   		<p align="right" id="overviewChartsButton">
		   			<a href="javascript:plotOverviewCharts();">Overview</a>
		   		</p>
		   		<div>
		   			<h4 class="chartTitle">Chart</h4>
		   			<div style="width: 400px; height: 200px;" id="chart"/>
		   		</div>
		   		<div>
		   			<h4 class="chartTitle">Chart</h4>
		   			<div style="width: 400px; height: 200px; display: hidden;" id="chart2"/>
		   		</div>
		   		<div>
		   			<h4 class="chartTitle">Chart</h4>
		   			<div style="width: 400px; height: 200px; display: hidden;" id="chart3"/>
		   		</div>
		   		<div>
		   			<h4 class="chartTitle">Chart</h4>
		   			<div style="width: 400px; height: 200px; display: hidden;" id="chart4"/>
		   		</div>
		   	</td>
	   	</tr>
   	</table>
   	
   	
   	<script type="text/javascript">
   		collapseAll();
   		
   		function showPrimaryChart() {
   			$("#chart").parent().show();
   		}
   		
   		function hidePrimaryChart() {
   			$("#chart").parent().hide();
   		}
   		
   		var overviewCharts = ["#chart2", "#chart3", "#chart4"];
   		
   		function hideOverviewCharts() {
	   		$(overviewCharts[0]).parent().hide();
	   		$(overviewCharts[1]).parent().hide();
	   		$(overviewCharts[2]).parent().hide();
   		}
   		
   		function showOverviewCharts() {
	   		$(overviewCharts[0]).parent().show();
	   		$(overviewCharts[1]).parent().show();
	   		$(overviewCharts[2]).parent().show();
   		}
   		
   		function plotOverviewCharts() {
   			showOverviewCharts();
   			
   			var pies = $(".m-7");
   			plotPieChart($($(pies.get(pies.length-1)).children().get(0)), "#chart2", "Total Availability, %");
   			var histograms = $(".m-4");
   			plotHistogramChart($($(histograms.get(histograms.length-1)).children().get(0)), "#chart4", "Total Response Time, ms");
			removeHighlights();
   			plotLineChart($($(".m-0").get(0)), "#chart3");
   			plotLineChart($($(".m-5").get(0)), "#chart");
   		}
   		
   		if ($("#view").val().indexOf("day") != 0) {
   			plotOverviewCharts();
  		} else {
  			$("#overviewChartsButton").hide();
  			hidePrimaryChart();
  			hideOverviewCharts();
  		}
   	</script>
   	
	<t:footer/>
</body>
</html>
